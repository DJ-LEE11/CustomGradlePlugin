# Using KSP on KMM

## KSP

### 什么是 KSP?
Kotlin Symbol Processing (KSP) 是一个在编译时通过注解生成代码的 Kotlin 插件。<br />
通过 KSP 可以帮助我们生成大量重复的代码，从而减少开发的工作量和提高代码的可读性和可维护性。<br />

关键词：`编译时期`、`注解`、`生成代码`。

### KSP 与 APT(kapt) 的对比

### 相同点
* 都是在编译时处理注解的工具。
* 都可以通过注解来生成代码或执行其他操作。
* 都需要使用 Gradle 或 Maven 等构建工具来集成到项目中。

### 差异点

#### 1、实现原理
APT 实现原理是基于 Java Compiler API 上的注解处理器 API，<br />
即在编译时使用 javac 将源代码编译成 Java 字节码文件，并在编译过程中调用注解处理器处理指定的注解。<br />

KSP 实现原理是基于 Kotlin Compiler API 上的符号处理器 API，<br />
在编译时 KSP 就可以直接访问 Kotlin 代码中的类型、函数、属性等信息，而不需要进行额外的类型转换或者解析，
也不需要生成额外的字节码文件。<br />

主要差异：KSP 与 Kotlin `共享类型系统`。

#### 2、性能对比
* APT 和 Java 不共享类型系统，在编辑时期需要消耗更多的时间来加载和解析源代码文件。
* APT 需要先将源代码编译成字节码文件，这会消耗额外的时间和磁盘空间。
* KSP 支持增量编译，只有修改过的代码才会重新处理，大大提高了处理效率。

所以，KSP `性能和编译效率`高于 APT。<br />
官方在一个使用 Room 的项目进行编译对比，KSP 比 KAPT 编译快2倍以上。

#### 3、集成对比
KSP 插件已经包含在 Gradle 插件中，在集成到项目的时候无需再手动添加插件依赖项。

#### 4、跨平台
KSP 作为 Kotlin 编译器插件运行，无需依赖 Java 注释处理基础架构，<br />
意味着 KSP 可以在非 Android 以及非 JVM 环境 (如 Kotlin/Native 和 Kotlin/JS) 中使用。

### KSP 开发流程?
1、集成 KSP 插件。<br />
2、自定义注解处理器。<br />
3、通过注解处理器获取获取要处理的注解信息并生成Kotlin代码。

### 生成Kotlin代码?
1、代码拼接

2、KotlinPoet
提供API用更加简洁优雅的方式要替代繁琐冗杂的重复工作。

## KSP 实现 Http 请求代码自动生成

### step1
XXXXXXXXXXXX<br />
YYYYYYYYYYYYYYY<br />

### step2
XXXXXXXXXXXX<br />
YYYYYYYYYYYYYYY<br />

### step3
XXXXXXXXXXXX<br />
YYYYYYYYYYYYYYY<br />

## Http 请求代码自动生成具体实现

详情可以参考一下工程：<br />
[https://git.yy.com/apps/liveanchor/baizhankmm-homepage/-/tree/ksp/kspcompiler](https://git.yy.com/apps/liveanchor/baizhankmm-homepage/-/tree/ksp/kspcompiler)


