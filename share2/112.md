# Android前后台切换监听方案

### 一、旧方案

在Application中registerActivityLifecycleCallbacks，通过变量统计然后判断出是前台还是后台。

    application.registerActivityLifecycleCallbacks(object :
            Application.ActivityLifecycleCallbacks {

            、、、、、、、、

            override fun onActivityStarted(activity: Activity) {
                resumedActCount++
                KLog.i(TAG, "应用回到前台")
            }

            override fun onActivityStopped(activity: Activity) {
                resumedActCount--
                if (resumedActCount == 0) {
                    KLog.i(TAG, "应用退到后台")
                }
            }
        })




### 二、新方案 ProcessLifecycleOwner

ProcessLifecycleOwner是Google Lifecycle中的一个类，更优雅的监听前后台的切换。


1、添加依赖

     // 使用前需引用一下：
    implementation "android.arch.lifecycle:extensions:1.1.1"
	implementation 'android.arch.lifecycle:runtime:1.1.1'


2、在Application中使用


    class MyApp : Application(), LifecycleEventObserver {

    	override fun onCreate() {
        	super.onCreate()
        	ProcessLifecycleOwner.get().lifecycle.addObserver(this)
    	}

    	override fun onStateChanged(source: LifecycleOwner, event: Lifecycle.Event) {
        	when (event) {
            	Lifecycle.Event.ON_START -> {
                	KLog.i(TAG, "应用回到前台")
            	}
            	Lifecycle.Event.ON_STOP -> {
                	KLog.i(TAG, "应用回到后台")
            	}
        	}
    	}
    }

